import{r as m,j as e,f as R,L as P,u as M,a as A,b as D,c as I,d as L,g as k,h as U}from"./index-xvdbN6-H.js";import{S as O}from"./skeleton-CO-u1M0P.js";import{l as u,S as B}from"./home.module-CbfyJERK.js";import{m as H}from"./proxy-BozZERwT.js";const v=["BINANCE:BTCUSDT","BINANCE:ETHUSDT","BINANCE:BNBUSDT","BINANCE:XRPUSDT","BINANCE:SOLUSDT","BINANCE:ADAUSDT"];function F(s){const i=s.match(/:([A-Z]+)USDT$/);return i?i[1]:s}async function q(s){const i=new URL("/api/fh/quotes-batch",window.location.origin);i.searchParams.set("symbols",s.join(","));const a=await fetch(i.toString(),{cache:"no-store"});if(!a.ok)throw new Error(`HTTP ${a.status}`);return a.json()}function G(){const[s,i]=m.useState([]),[a,h]=m.useState(null),t=m.useRef(null),n=async()=>{if(!(a&&Date.now()<a))try{const c=await q(v),d=v.map(l=>{var g;const _=((g=c.items)==null?void 0:g.find(w=>w.symbol===l))||null,j=c.quotes?{symbol:l,quote:c.quotes[l]??null}:null;return _||j||{symbol:l,quote:null}});i(d),c.backoffUntil&&c.backoffUntil>Date.now()?h(c.backoffUntil):h(null)}catch{}};m.useEffect(()=>{n();const c=window.setInterval(n,45e3);return t.current=c,()=>{t.current!=null&&window.clearInterval(t.current)}},[]);const r=m.useMemo(()=>v.map(c=>{var g,w;const d=s.find(N=>N.symbol===c),l=((g=d==null?void 0:d.quote)==null?void 0:g.c)??null,_=((w=d==null?void 0:d.quote)==null?void 0:w.pc)??null,j=l!=null&&_!=null&&_!==0?(l-_)/_*100:null;return{sym:c,label:F(c),c:l,pct:j,cached:!!(d!=null&&d.cached)}}),[s]);return e.jsxs("div",{style:{display:"flex",gap:8,overflowX:"auto",padding:"4px 2px",alignItems:"center"},children:[r.map(c=>e.jsxs("div",{style:{display:"flex",gap:8,padding:"8px 12px",border:"1px solid var(--border)",borderRadius:10,whiteSpace:"nowrap",background:"var(--card-bg)",boxShadow:"var(--shadow)",opacity:c.cached?.9:1,flex:"0 0 auto",minWidth:130},title:c.pct!=null?`${c.pct>=0?"+":""}${c.pct.toFixed(2)}%`:"",children:[e.jsx("strong",{style:{opacity:.9},children:c.label}),e.jsx("span",{style:{opacity:.9},children:c.c!=null?c.c.toFixed(2):"—"}),e.jsx("span",{style:{fontWeight:700,color:c.pct!=null?c.pct>=0?"#22c55e":"#ef4444":"inherit"},children:c.pct!=null?(c.pct>=0?"+":"")+c.pct.toFixed(2)+"%":""})]},c.sym)),a&&Date.now()<a&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,opacity:.75},children:["rate-limited… retry ",Math.ceil((a-Date.now())/1e3),"s"]})]})}const W="_wrap_1woct_1",z="_header_1woct_12",Y="_item_1woct_14",J="_thumb_1woct_21",V="_text_1woct_28",Z="_title_1woct_29",X="_meta_1woct_30",K="_badge_1woct_31",f={wrap:W,header:z,item:Y,thumb:J,text:V,title:Z,meta:X,badge:K},S="newsMiniCacheV1",Q=12e4;function ee(s){const i=Math.max(1,Math.round((Date.now()-s*1e3)/6e4));if(i<60)return`${i}m ago`;const a=Math.round(i/60);return a<24?`${a}h ago`:`${Math.round(a/24)}d ago`}function se(){const[s,i]=m.useState(null),a=m.useRef(null);m.useEffect(()=>{try{const t=localStorage.getItem(S);if(t){const{ts:n,data:r}=JSON.parse(t);Date.now()-n<Q&&Array.isArray(r)&&r.length&&i(r)}}catch{}},[]);const h=async()=>{var t;try{(t=a.current)==null||t.abort();const n=new AbortController;a.current=n;const r=await fetch("/api/fh/news?category=general",{signal:n.signal,cache:"no-store"});if(!r.ok)throw new Error(`HTTP ${r.status}`);const d=(await r.json()??[]).slice(0,6).map(l=>({title:l.headline,source:l.source,time:ee(l.datetime),url:l.url,image:l.image&&l.image.startsWith("http")?l.image:void 0}));i(d);try{localStorage.setItem(S,JSON.stringify({ts:Date.now(),data:d}))}catch{}}catch{}};return m.useEffect(()=>{h();const t=setInterval(h,5*6e4);return()=>{var n;clearInterval(t),(n=a.current)==null||n.abort()}},[]),s?s.length===0?null:e.jsxs("div",{className:f.wrap,children:[e.jsx("div",{className:f.header,children:"Latest investing news"}),s.map((t,n)=>{var r;return e.jsxs("a",{href:t.url,target:"_blank",className:f.item,rel:"noopener noreferrer nofollow","aria-label":`${t.title} — ${t.source}`,children:[e.jsx("div",{className:f.thumb,children:t.image?e.jsx("img",{src:t.image,alt:t.source,loading:"lazy",width:60,height:60}):e.jsx("span",{children:((r=t.source)==null?void 0:r[0])??"•"})}),e.jsxs("div",{className:f.text,children:[e.jsx("div",{className:f.title,children:t.title}),e.jsxs("div",{className:f.meta,children:[e.jsx("span",{className:f.badge,children:t.source}),e.jsx("span",{children:t.time})]})]})]},n)})]}):e.jsxs("div",{className:f.wrap,children:[e.jsx("div",{className:f.header,children:"Latest investing news"}),Array.from({length:4}).map((t,n)=>e.jsxs("div",{className:f.item,style:{pointerEvents:"none"},children:[e.jsx("div",{className:f.thumb}),e.jsxs("div",{className:f.text,children:[e.jsx("div",{className:f.title}),e.jsx("div",{className:f.meta})]})]},n))]})}const te="_wrap_1wfrs_2",ae="_card_1wfrs_2",ne="_header_1wfrs_14",re="_skelList_1wfrs_17",ce="_skelCard_1wfrs_18",ie="_empty_1wfrs_26",oe="_list_1wfrs_29",le="_first_1wfrs_45",de="_rowHead_1wfrs_47",me="_rank_1wfrs_55",he="_ticker_1wfrs_65",ue="_delta_1wfrs_76",pe="_up_1wfrs_83",fe="_down_1wfrs_84",_e="_name_1wfrs_86",xe="_meta_1wfrs_95",ge="_kvItem_1wfrs_104",je="_sep_1wfrs_109",we="_dot_1wfrs_110",Ne="_chip_1wfrs_115",ve="_badges_1wfrs_124",be="_badge_1wfrs_124",ye="_cta_1wfrs_134",o={wrap:te,card:ae,header:ne,skelList:re,skelCard:ce,empty:ie,list:oe,first:le,rowHead:de,rank:me,ticker:he,delta:ue,up:pe,down:fe,name:_e,meta:xe,kvItem:ge,sep:je,dot:we,chip:Ne,badges:ve,badge:be,cta:ye};function ke(s){return s!=null&&Number.isFinite(s)?`$${s.toFixed(2)}`:"—"}function Se(s){return s&&s!=="-"?s:"—"}function Te(s){return s===0?"#1":s===1?"#2":"#3"}function Ee(){const[s,i]=m.useState(null),[a,h]=m.useState(null);m.useEffect(()=>{let n=!0;return R("/api/finviz.ts?mode=topgainers&limit=3",{timeoutMs:12e3}).then(r=>{n&&i(r.items||[])}).catch(r=>{n&&h(String((r==null?void 0:r.message)||r))}),()=>{n=!1}},[]);const t=m.useMemo(()=>(s??[]).slice(0,3),[s]);return e.jsxs("div",{className:o.wrap,"data-layout":"vertical",children:[e.jsx("div",{className:o.header,children:"Top gainers"}),a&&e.jsxs("div",{className:o.empty,children:["Failed to load: ",a]}),!a&&s===null&&e.jsxs("div",{className:o.skelList,children:[e.jsx("div",{className:o.skelCard}),e.jsx("div",{className:o.skelCard}),e.jsx("div",{className:o.skelCard})]}),!a&&s&&t.length===0&&e.jsx("div",{className:o.empty,children:"No intraday leaders yet."}),!a&&t.length>0&&e.jsx("div",{className:o.list,children:t.map((n,r)=>e.jsxs("article",{className:`${o.card} ${r===0?o.first:""}`,children:[e.jsxs("div",{className:o.rowHead,children:[e.jsx("span",{className:o.rank,children:Te(r)}),e.jsx("h4",{className:o.ticker,children:n.ticker}),e.jsxs("span",{className:`${o.delta} ${Number(n.changePct??0)>=0?o.up:o.down}`,children:[Number(n.changePct??0)>=0?"+":"",(n.changePct??0).toFixed(2),"%"]})]}),e.jsx("div",{className:o.name,title:n.company??void 0,children:n.company??"—"}),e.jsxs("div",{className:o.meta,children:[e.jsx("span",{className:o.chip,children:ke(n.price)}),e.jsx("span",{className:o.dot}),e.jsx("span",{className:o.kvItem,title:n.sector??void 0,children:n.sector??"—"}),e.jsx("span",{className:o.sep,children:"•"}),e.jsx("span",{className:o.kvItem,title:n.industry??void 0,children:n.industry??"—"})]}),e.jsxs("div",{className:o.badges,children:[e.jsxs("span",{className:o.badge,children:["Mkt Cap: ",Se(n.marketCapText)]}),n.pe!=null&&Number.isFinite(n.pe)&&e.jsxs("span",{className:o.badge,children:["P/E: ",n.pe.toFixed(2)]})]}),e.jsx(P,{to:`/stocks/${n.ticker}`,className:o.cta,children:"View Details"})]},n.ticker))})]})}const $e="America/New_York";function T(s){return s<10?`0${s}`:String(s)}function E(s=new Date){const i=new Intl.DateTimeFormat("en-US",{timeZone:$e,hour12:!1,weekday:"short",hour:"2-digit",minute:"2-digit"}),a=Object.fromEntries(i.formatToParts(s).map(t=>[t.type,t.value])),h={Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6}[a.weekday]??0;return{hh:Number(a.hour),mm:Number(a.minute),wdNum:h,timeText:`${T(Number(a.hour))}:${T(Number(a.minute))} ET`}}function Ce(){if(typeof window>"u")return null;switch((new URLSearchParams(window.location.search).get("debugMarket")||localStorage.getItem("invapp.debugMarket")||"").toLowerCase()){case"regular":case"open":case"opened":return"Regular";case"pre":case"pre-market":case"premarket":return"Pre-market";case"after":case"after-hours":case"afterhours":return"After-hours";case"closed":case"close":return"Closed";default:return null}}function $(s=new Date){const i=Ce();if(i)return{session:i,isOpen:i==="Regular",nowEtText:E(s).timeText};const a=E(s),h=a.hh*60+a.mm,t=a.wdNum===0||a.wdNum===6,n=240,r=570,c=960,d=1200;let l="Closed";return t||(h>=r&&h<c?l="Regular":h>=n&&h<r?l="Pre-market":h>=c&&h<d&&(l="After-hours")),{session:l,isOpen:l==="Regular",nowEtText:a.timeText}}const Re="_wrap_1pjpi_1",Pe="_header_1pjpi_12",Me="_title_1pjpi_19",Ae="_pill_1pjpi_25",De="_time_1pjpi_34",Ie="_meta_1pjpi_39",Le="_table_1pjpi_45",Ue="_th_1pjpi_53",Oe="_thRight_1pjpi_58",Be="_td_1pjpi_60",He="_tdRight_1pjpi_64",Fe="_open_1pjpi_68",qe="_closed_1pjpi_69",Ge="_closedPane_1pjpi_71",p={wrap:Re,header:Pe,title:Me,pill:Ae,time:De,meta:Ie,table:Le,th:Ue,thRight:Oe,td:Be,tdRight:He,open:Fe,closed:qe,closedPane:Ge};function We(){const s=$(),i=[{exchange:"NYSE",status:s.isOpen?"Open":"Closed"},{exchange:"NASDAQ",status:s.isOpen?"Open":"Closed"}];return e.jsxs("div",{role:"region","aria-label":"US market status",className:p.wrap,children:[e.jsxs("div",{className:p.header,children:[e.jsx("strong",{className:p.title,children:"US Market"}),e.jsx("span",{className:p.pill,children:s.session}),e.jsx("span",{className:p.time,children:s.nowEtText})]}),e.jsx("div",{className:p.meta,children:"Snapshot: Finviz"}),e.jsxs("table",{className:p.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:p.th,children:"Exchange"}),e.jsx("th",{className:`${p.th} ${p.thRight}`,children:"Status"})]})}),e.jsx("tbody",{children:i.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:p.td,children:a.exchange}),e.jsx("td",{className:`${p.td} ${p.tdRight} ${a.status==="Open"?p.open:p.closed}`,children:a.status})]},a.exchange))})]}),e.jsx("div",{className:p.closedPane,children:"Market closed"})]})}const Ze=()=>{const{t:s}=M(),i=A(),a=D(),h=I(),t=Math.max(1,Number(h.page??"1")||1),{items:n,status:r,hasMore:c,pageEpoch:d}=L(x=>x.stocks),l=m.useRef(null),_=m.useRef(null),j=m.useRef(null);m.useEffect(()=>{i(k({page1:t}))},[i,t]),m.useEffect(()=>{var y;const x=_.current;r==="succeeded"&&(x!==null&&x!==t||x!==null)&&((y=l.current)==null||y.scrollIntoView({behavior:"smooth",block:"start"})),r==="succeeded"&&(_.current=t)},[t,r]),m.useEffect(()=>{r==="succeeded"&&j.current!==d&&(j.current=d,i(U()))},[r,d,i]);const g=m.useMemo(()=>n,[n]),w=$(),N=()=>{t>1&&a(`/${t-1}`)},C=()=>{c&&a(`/${t+1}`)};return e.jsx(H.div,{className:u.page,initial:{opacity:0},animate:{opacity:1},children:e.jsxs("div",{className:u.container,children:[e.jsxs("section",{className:u.intro,style:{margin:"16px 0"},children:[e.jsx("h1",{style:{margin:0},children:s("main.title")}),e.jsx("p",{style:{opacity:.9},children:s("main.subtitle")}),e.jsx("p",{style:{marginTop:8},children:s("homeHero.description")}),e.jsx("h3",{style:{marginTop:12},children:s("homeHero.criteriaTitle")}),e.jsxs("ul",{style:{paddingLeft:18,marginTop:6},children:[e.jsx("li",{children:s("homeHero.criteria.pe")}),e.jsx("li",{children:s("homeHero.criteria.ps")}),e.jsx("li",{children:s("homeHero.criteria.price")})]}),e.jsx("p",{style:{marginTop:8},children:s("homeHero.notes")}),e.jsx("p",{style:{marginTop:4,fontStyle:"italic",opacity:.9},children:s("homeHero.frontendOnly")})]}),e.jsx("div",{className:u.topBar,children:e.jsx(G,{})}),e.jsx("header",{className:u.hero}),e.jsxs("section",{className:u.headerGrid,children:[e.jsx("div",{className:u.newsCol,children:e.jsx(se,{})}),e.jsx("aside",{className:u.sideCol,children:w.isOpen?e.jsx(Ee,{}):e.jsx(We,{})})]}),r==="loading"&&n.length===0&&e.jsx("div",{className:u.skeletonWrap,children:e.jsx("div",{className:u.cardsGrid,children:Array.from({length:6}).map((x,b)=>e.jsx("div",{children:e.jsx(O,{height:140,style:{marginBottom:12}})},b))})}),r==="failed"&&e.jsxs("div",{className:u.error,children:["Fetch failed. ",e.jsx("button",{onClick:()=>i(k({page1:t})),children:"Retry"})]}),e.jsxs("main",{className:u.listArea,children:[e.jsx("div",{ref:l,style:{scrollMarginTop:80}}),e.jsx("div",{className:u.cardsGrid,children:g.map(x=>e.jsx(B,{stock:x},x.ticker))}),e.jsxs("div",{className:u.moreRow,children:[t>1&&e.jsx("button",{className:u.moreBtn,onClick:N,disabled:r==="loading",children:"Prev 20"}),e.jsxs("div",{className:u.pageLabel,children:["Page ",t]}),e.jsx("button",{className:u.moreBtn,onClick:C,disabled:!c||r==="loading",children:r==="loading"?"Loading…":"Next 20"})]})]})]})})};export{Ze as Home,Ze as default};
