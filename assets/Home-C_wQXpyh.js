import{u as A,a as T,j as e,r as l,L as B,b as k,f as D,c as M}from"./index-1Y6r_F-G.js";import{S as P}from"./skeleton-BOAoqV1h.js";import{S as E}from"./StockCard-CmJwiCNF.js";import{m as $}from"./proxy-DXBtU357.js";const L=A,b=T,q="_grid_8h209_1",y={grid:q};function U({stocks:t}){const n=Array.isArray(t)?t:[];return n.length===0?e.jsx("div",{className:y.empty,children:"No stocks to show"}):e.jsx("div",{className:y.grid,children:n.map(s=>e.jsx(E,{stock:s},s.ticker))})}async function I(t){const n=new URL(t,window.location.origin);n.searchParams.set("ts",String(Date.now()));const s=await fetch(n.toString(),{cache:"no-store"});if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()}function S(){const[t,n]=l.useState(null);return l.useEffect(()=>{const r=async()=>{try{const o=await I("/api/fh/marketStatus");n(o)}catch{}};r();const a=setInterval(r,5*6e4);return()=>clearInterval(a)},[]),l.useMemo(()=>{const r=(t==null?void 0:t.isOpen)??!1,a=new Date().getUTCDay();return{isOpen:r,reason:r?null:a===0||a===6?"Weekend":"Market closed"}},[t])}const v=["BINANCE:BTCUSDT","BINANCE:ETHUSDT","BINANCE:BNBUSDT","BINANCE:XRPUSDT","BINANCE:SOLUSDT","BINANCE:ADAUSDT"];function R(t){const n=t.match(/:([A-Z]+)USDT$/);return n?n[1]:t}async function O(t){const n=new URL("/api/fh/quotes-batch",window.location.origin);n.searchParams.set("symbols",t.join(","));const s=await fetch(n.toString(),{cache:"no-store"});if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()}function F(){const[t,n]=l.useState([]),[s,r]=l.useState(null),a=l.useRef(null),o=async()=>{if(!(s&&Date.now()<s))try{const c=await O(v);n(c.items||[]),c.backoffUntil&&c.backoffUntil>Date.now()?r(c.backoffUntil):r(null)}catch{}};l.useEffect(()=>{o();const c=window.setInterval(o,2e4);return a.current=c,()=>{a.current!=null&&window.clearInterval(a.current)}},[]);const i=l.useMemo(()=>v.map(c=>{var _,x;const h=t.find(w=>w.symbol===c),m=((_=h==null?void 0:h.quote)==null?void 0:_.c)??null,g=((x=h==null?void 0:h.quote)==null?void 0:x.pc)??null,f=m!=null&&g!=null&&g!==0?(m-g)/g*100:null;return{sym:c,label:R(c),c:m,pct:f,cached:!!(h!=null&&h.cached)}}),[t]);return e.jsxs("div",{style:{display:"flex",gap:8,overflowX:"auto",padding:"4px 2px",alignItems:"center"},children:[i.map(c=>e.jsxs("div",{style:{display:"flex",gap:8,padding:"4px 8px",border:"1px solid var(--border)",borderRadius:999,whiteSpace:"nowrap",background:"rgba(255,255,255,.04)",opacity:c.cached?.8:1},title:c.pct!=null?`${c.pct>=0?"+":""}${c.pct.toFixed(2)}%`:"",children:[e.jsx("strong",{style:{opacity:.85},children:c.label}),e.jsx("span",{style:{opacity:.85},children:c.c!=null?c.c.toFixed(2):"—"}),e.jsx("span",{style:{fontWeight:600,color:c.pct!=null?c.pct>=0?"#22c55e":"#ef4444":"inherit"},children:c.pct!=null?(c.pct>=0?"+":"")+c.pct.toFixed(2)+"%":""})]},c.sym)),s&&Date.now()<s&&e.jsxs("span",{style:{marginLeft:8,fontSize:12,opacity:.75},children:["rate-limited… retry ",Math.ceil((s-Date.now())/1e3),"s"]})]})}const z="_wrap_17bkm_1",H="_header_17bkm_23",W="_item_17bkm_27",G="_thumb_17bkm_41",J="_text_17bkm_55",V="_title_17bkm_57",Y="_meta_17bkm_59",Q="_badge_17bkm_61",d={wrap:z,header:H,item:W,thumb:G,text:J,title:V,meta:Y,badge:Q},N="newsMiniCacheV1",X=12e4;function K(t){const n=Math.max(1,Math.round((Date.now()-t*1e3)/6e4));if(n<60)return`${n}m ago`;const s=Math.round(n/60);return s<24?`${s}h ago`:`${Math.round(s/24)}d ago`}function Z(){const[t,n]=l.useState(null),s=l.useRef(null);l.useEffect(()=>{try{const a=localStorage.getItem(N);if(a){const{ts:o,data:i}=JSON.parse(a);Date.now()-o<X&&Array.isArray(i)&&i.length&&n(i)}}catch{}},[]);const r=async()=>{var a;try{(a=s.current)==null||a.abort();const o=new AbortController;s.current=o;const i=await fetch("/api/fh/news?category=general",{signal:o.signal,cache:"no-store"});if(!i.ok)throw new Error(`HTTP ${i.status}`);const h=(await i.json()??[]).slice(0,6).map(m=>({title:m.headline,source:m.source,time:K(m.datetime),url:m.url,image:m.image&&m.image.startsWith("http")?m.image:void 0}));n(h);try{localStorage.setItem(N,JSON.stringify({ts:Date.now(),data:h}))}catch{}}catch{}};return l.useEffect(()=>{r();const a=setInterval(r,5*6e4);return()=>{var o;clearInterval(a),(o=s.current)==null||o.abort()}},[]),t?t.length===0?null:e.jsxs("div",{className:d.wrap,children:[e.jsx("div",{className:d.header,children:"Latest investing news"}),t.map((a,o)=>{var i;return e.jsxs("a",{href:a.url,target:"_blank",className:d.item,rel:"noopener noreferrer nofollow","aria-label":`${a.title} — ${a.source}`,children:[e.jsx("div",{className:d.thumb,children:a.image?e.jsx("img",{src:a.image,alt:a.source,loading:"lazy",width:60,height:60}):e.jsx("span",{children:((i=a.source)==null?void 0:i[0])??"•"})}),e.jsxs("div",{className:d.text,children:[e.jsx("div",{className:d.title,children:a.title}),e.jsxs("div",{className:d.meta,children:[e.jsx("span",{className:d.badge,children:a.source}),e.jsx("span",{children:a.time})]})]})]},o)})]}):e.jsxs("div",{className:d.wrap,children:[e.jsx("div",{className:d.header,children:"Latest investing news"}),Array.from({length:4}).map((a,o)=>e.jsxs("div",{className:d.item,style:{pointerEvents:"none"},children:[e.jsx("div",{className:d.thumb}),e.jsxs("div",{className:d.text,children:[e.jsx("div",{className:d.title}),e.jsx("div",{className:d.meta})]})]},o))]})}const ee="_wrap_hqwxl_1",te="_header_hqwxl_21",se="_list_hqwxl_33",ae="_card_hqwxl_45",ne="_rowHead_hqwxl_73",re="_ticker_hqwxl_87",ce="_delta_hqwxl_103",oe="_up_hqwxl_105",ie="_down_hqwxl_107",le="_name_hqwxl_111",de="_kv_hqwxl_123",he="_k_hqwxl_123",pe="_v_hqwxl_137",me="_cta_hqwxl_141",p={wrap:ee,header:te,list:se,card:ae,rowHead:ne,ticker:re,delta:ce,up:oe,down:ie,name:le,kv:de,k:he,v:pe,cta:me};function ue(t,n=3){const s=t.filter(r=>typeof r.changePct=="number");return s.length>=n?[...s].sort((r,a)=>a.changePct-r.changePct).slice(0,n):[{ticker:"APT",name:"Alpha Pro Tech",category:"small",price:1.19,changePct:208.39},{ticker:"LGPS",name:"Light Leap",category:"small",price:.67,changePct:107.11},{ticker:"CMT",name:"Core Mfg Tech",category:"small",price:19.16,changePct:33.76}]}function xe({layout:t="vertical"}){const n=b(r=>r.stocks.items),s=ue(n,3);return e.jsxs("div",{className:p.wrap,"data-layout":t,children:[e.jsx("div",{className:p.header,children:"Top gainers (24h)"}),e.jsx("div",{className:p.list,children:s.map(r=>{var a;return e.jsxs("article",{className:p.card,children:[e.jsxs("div",{className:p.rowHead,children:[e.jsx("h4",{className:p.ticker,children:r.ticker}),e.jsxs("span",{className:`${p.delta} ${r.changePct>=0?p.up:p.down}`,children:[r.changePct>=0?"+":"",(a=r.changePct)==null?void 0:a.toFixed(2),"%"]})]}),e.jsx("div",{className:p.name,title:r.name,children:r.name??"—"}),e.jsxs("div",{className:p.kv,children:[e.jsx("span",{className:p.k,children:"Price"}),e.jsx("span",{className:p.v,children:r.price!=null?`$${r.price.toFixed(2)}`:"—"})]}),e.jsx(B,{to:`/stocks/${r.ticker}`,className:p.cta,children:"View Details"})]},r.ticker)})})]})}function ge(){const t=S(),n=[{exchange:"NYSE",status:t.isOpen?"Open":"Closed"},{exchange:"NASDAQ",status:t.isOpen?"Open":"Closed"}];return e.jsxs("div",{role:"region","aria-label":"US market status",style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,padding:"10px 12px",border:"1px solid var(--border)",borderRadius:12,background:"rgba(255,255,255,.04)",margin:"8px 0 14px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[e.jsx("strong",{style:{fontSize:14,opacity:.9},children:"US Market"}),!t.isOpen&&e.jsx("span",{style:{fontSize:12,padding:"2px 8px",borderRadius:999,border:"1px solid var(--border)",opacity:.85},children:t.reason??"Closed"})]}),e.jsx("div",{style:{textAlign:"right",fontSize:12,opacity:.75},children:"Snapshot: Finviz"}),e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:0,fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"left",padding:"8px 6px",opacity:.7},children:"Exchange"}),e.jsx("th",{style:{textAlign:"right",padding:"8px 6px",opacity:.7},children:"Status"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"6px 6px",borderTop:"1px solid var(--border)"},children:s.exchange}),e.jsx("td",{style:{padding:"6px 6px",borderTop:"1px solid var(--border)",textAlign:"right",fontWeight:600,color:s.status==="Open"?"#22c55e":"#ef4444"},children:s.status})]},s.exchange))})]})})]})}const _e="_page_5tnf1_1",fe="_container_5tnf1_11",we="_topBar_5tnf1_21",je="_hero_5tnf1_25",ke="_marketBadge_5tnf1_39",ye="_headerGrid_5tnf1_85",ve="_newsCol_5tnf1_101",Ne="_sideCol_5tnf1_101",be="_listArea_5tnf1_123",Se="_moreRow_5tnf1_127",Ce="_moreBtn_5tnf1_139",Ae="_skeletonWrap_5tnf1_157",Te="_error_5tnf1_159",u={page:_e,container:fe,topBar:we,hero:je,marketBadge:ke,headerGrid:ye,newsCol:ve,sideCol:Ne,listArea:be,moreRow:Se,moreBtn:Ce,skeletonWrap:Ae,error:Te},Ee=()=>{const t=L(),{items:n,status:s,hasMore:r}=b(x=>x.stocks),a=S(),o=a.reason!=null&&!a.isOpen,[i,c]=l.useState(20),[h,m]=l.useState(0);l.useEffect(()=>{t(k({pages:1}))},[t]),l.useEffect(()=>{c(20)},[n]);const g=i<n.length||r,f=async()=>{if(c(x=>Math.min(x+20,n.length+20)),r){const x=h+1;try{const w=await t(D({page:x})).unwrap();m(x);const j=w.map(C=>C.ticker);j.length&&await t(M({tickers:j,concurrency:2}))}catch{}}},_=l.useMemo(()=>n.slice(0,i),[n,i]);return e.jsx($.div,{className:u.page,initial:{opacity:0},animate:{opacity:1},children:e.jsxs("div",{className:u.container,children:[e.jsx("div",{className:u.topBar,children:e.jsx(F,{})}),e.jsxs("header",{className:u.hero,children:[e.jsx(ge,{}),o&&e.jsxs("div",{className:u.marketBadge,"aria-live":"polite",children:["US market: ",a.reason]})]}),e.jsxs("section",{className:u.headerGrid,children:[e.jsx("div",{className:u.newsCol,children:e.jsx(Z,{})}),e.jsx("aside",{className:u.sideCol,children:e.jsx(xe,{layout:"vertical"})})]}),s==="loading"&&n.length===0&&e.jsx("div",{className:u.skeletonWrap,children:e.jsx(P,{count:6,height:140,style:{marginBottom:12}})}),s==="failed"&&e.jsxs("div",{className:u.error,children:["Fetch failed. ",e.jsx("button",{onClick:()=>t(k({pages:1})),children:"Retry"})]}),e.jsxs("main",{className:u.listArea,children:[e.jsx(U,{stocks:_}),g&&e.jsx("div",{className:u.moreRow,children:e.jsx("button",{className:u.moreBtn,onClick:f,children:"Load next 20"})})]})]})})};export{Ee as Home};
